<!DOCTYPE html>
<html amp lang="fr">
<head>
<meta charset="utf-8">
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136089997-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-136089997-1');
</script>
<!-- Note: plugin scripts must be included after the tracking snippet. -->
<script src="https://ipmeta.io/plugin.js"></script>
<script>
	provideGtagPlugin({
	apiKey: '18bf8f1d26cb517fdf42fd4d789a01445f8245eab896aa42997500bf9f5d5702',
	serviceProvider: 'dimension1',
	networkDomain: 'dimension2',
	networkType: 'dimension3',
	});
</script>         
<!-- Global site tag (gtag.js) - Google Analytics -->	
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-WXJ6F8F');</script>
        <!-- End Google Tag Manager -->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="author" content="Roque Leal" />
        <meta name="copyright" content="https://oilmap.xyz" />
        <meta property="fb:admins" content="1573187928" />
        <meta name="description" content="ü•á D√©couvrez la Carte P√©troli√®re du Monde 2021, avec des informations et des connaissances du monde p√©tro√©nerg√©tique dans de belles visualisations de donn√©es sur les activit√©s en amont et en aval pour le p√©trole et le gaz.‚úîÔ∏è">
        <meta name="keywords" content="P√©trole, Cartes, G√©ologie, gaz, √ânergie, D√©p√¥ts, Cartographie, Mapbox" />
        <meta property="og:image" content="https://oilmap.xyz/img/preview.jpg" link rel="image_src" type="image/jpg" href="https://oilmap.xyz/img/preview.jpg" />
        <meta property="og:type" content="website" />
		<meta property="og:image" content="https://oilmap.xyz/img/preview.jpg"/>
        <meta property="og:image:width" content="400" />
        <meta property="og:image:height" content="300" />
        <meta property="og:title" content="Carte du P√©trole et Gaz 2021" /> 
        <meta property="og:description" content="ü•á R√©ussissez dans n'importe quel environnement gr√¢ce √† la localisation mondiale et aux donn√©es temps r√©el de renseignement sur les activit√©s en Upstream y Downstream dans le secteur du p√©trole et du gaz. üó∫Ô∏è" />        
        <meta property="og:url" content="https://oilmap.xyz/fr.html" />     
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@roqueleal08">
        <meta name="twitter:title" content="Carte du P√©trole et Gaz 2021">
        <meta name="twitter:description" content="ü•á R√©ussissez dans n'importe quel environnement gr√¢ce √† la localisation mondiale et aux donn√©es temps r√©el de renseignement sur les activit√©s en Upstream y Downstream dans le secteur du p√©trole et du gaz. üó∫Ô∏è">
        <meta name="twitter:creator" content="@roqueleal08">
        <meta name="twitter:image" content="https://oilmap.xyz/img/preview.jpg">
        <title>ü•á Carte du P√©trole et Gaz 2021</title>
        <link rel="canonical" href="https://oilmap.xyz/fr.html">
		<link rel="alternate" href="https://oilmap.xyz" hreflang="en-us" />
		<link rel="alternate" href="https://oilmap.xyz/fr.html" hreflang="fr-fr" />
        <link rel="alternate" href="https://oilmap.xyz/es.html" hreflang="es-es" />
        <link rel="alternate" href="https://oilmap.xyz/ar.html" hreflang="ar-sa" /> 
	    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "inLanguage" : "fr-FR",
            "author": {
                "@type": "Person",
                "name": "Roque Leal",
                "image": {
                    "@type": "ImageObject",
                    "url": "https://roqueleal.me/images/us-data-scientist-blog.webp"
                }
            },
            "datePublished": "2021-04-15T11:14:14+09:00",
            "dateModified": "2021-04-15T11:14:14+09:00",
                "url": "https://oilmap.xyz/fr.html",
                "image": {
                    "@type": "ImageObject",
                    "url": "https://oilmap.xyz/img/preview.jpg"
                },

            "keywords": "P√©trole, Cartes, G√©ologie, gaz, √ânergie, D√©p√¥ts, Cartographie, Mapbox",
            "description": "R√©ussissez dans n'importe quel environnement gr√¢ce √† la localisation mondiale et aux donn√©es temps r√©el de renseignement sur les activit√©s en Upstream y Downstream dans le secteur du p√©trole et du gaz",
            "sameAs": ["https://twitter.com/roqueleal08", "https://www.linkedin.com/in/lealrlx"]
            }
    </script>
    <link rel="icon" type="image/png" href="./img/oilmap.png" sizes="16x16">
        <link rel="canonical" href="https://www.oilmap.xyz"/>
        <link rel="alternative" hreflang="en" href="https://www.oilmap.xyz/">
        <link rel="alternative" hreflang="es" href="https://www.oilmap.xyz/es.html">
        <link rel="alternative" hreflang="ar" href="https://www.oilmap.xyz/ar.html">
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
        <script src="./js/mapbox-gl.js"></script>
        <link href="./js/mapbox-gl.css" rel="stylesheet">
        <link href="./js/assembly.min.css" rel="stylesheet">
        <script async="" defer="" src="./js/assembly.js"></script>
        <script src="./js/jquery.min.js"></script>
        <body class="prose">
        <header class="bg-darken75 color-black h-auto-mm h6 ">
        <div class="flex-parent flex-parent--space-between-main w-full">
        <div class="flex-child ml240 mt24 mb12 color-yellow"><h2>Carte du P√©trole et Gaz 2021</h2></div>
        <div class="about-header flex-child mr24 mt30 mb50 txt-bold" style="color: #F0B823; text-shadow: 1px 1px 2px rgb(8, 8, 8), 0 0 1em rgb(253, 253, 255);">
        <svg class="icon inline mr6"><use xlink:href="#icon-question"></use></svg>Info</div>
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script><link
        rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
        type="text/css"/>
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
    </header>
    <link rel="stylesheet" href="./css/style.css">  
    </head>
    <body>
    
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WXJ6F8F"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
    <nav id="menu"></nav>
    <div id='map'></div>
    <div id='distance' class='distance-container'></div>
    <div id="distanceGuide" class="distance-container">
    <button onclick="measureDistance()">Measuring tool</button></div>
    <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoicm9xdWVsZWFsIiwiYSI6ImNqaHVzZTA4ODBkZjczdmt0cTNrbGo1ZWEifQ.m7xOPPWAFsY-A4cAr5nDAw';
    var map = new mapboxgl.Map({
        container: 'map',
            style: 'mapbox://styles/roqueleal/ckg8c3kqf3udn19p3zhhhia61',
            center: [18.369141,21.043491],
            zoom: 3
        });
    mapboxgl.setRTLTextPlugin('https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.1.0/mapbox-gl-rtl-text.js');
    map.addControl(new MapboxLanguage());
    </script>
    
<!-- modal-->
<div id="aboutModal" class="modal" style="display: none;">

    <!-- modal content -->
    <div class="modal-content">
        <span class="close">√ó</span>
        <img class="logo" src="./img/oilmap.png" style="width:50%;max-width:70px"><p></p>
        <h1><a href="https://www.roqueleal.me/indexfr.html" target="_blank">Carte P√©troli√®re du Monde 2021</a></h1>
        üåéüõ¢Ô∏è La carte p√©troli√®re est une nouvelle plate-forme ouverte pour surveiller facilement les activit√©s p√©troli√®res et gazi√®res dans le monde et suivre les nouvelles et les prix du p√©trole. Il vous donne acc√®s √† la recherche √† des s√©ries de licences p√©troli√®res et gazi√®res, √† des entreprises, √† des champs et √† des puits de p√©trole et √† des informations en direct sur l'industrie. </a><br>
        <h2><a href="https://oilmap.xyz/prices/oilprices.html" target="_blank">Cours du P√©trole 2021</a></h2>
        Vous pouvez √©galement consulter les prix de la plupart des s√©gr√©gations de p√©trole brut vendues dans le monde en temps r√©el et disponibles dans <a href="https://oilmap.xyz/prices/oilprices.html" target="_blank">Cours du P√©trole 2021</a>.<p></p>
        Je suis <a href="https://www.roqueleal.me/indexfr.html" target="_blank" >Roque Leal,
        </a> Je vous invite √† collaborer et partager vos id√©es, pour plus d'informations vous pouvez m'√©crire √†<a href="mailto:roqueleal@gmail.com"> roqueleal@gmail.com
        </a>.
        Remerciements particuliers √† <a href="https://blog.mapbox.com/bringing-data-to-life-with-powerbi-ccaf214eaf16" target="_blank">Mapbox</a> pour partager son inspiration et sa passion pour les cartes.<p>
        </p>Ce projet est distribu√© sous licence GPL Open Source. Vous pouvez visiter le r√©f√©rentiel de ce projet, disponible sur <a href="https://github.com/roqueleal/oilmap" target="_blank">Github</a>.<p></p>
        <a href="https://github.com/roqueleal/oilmap" target="_blank"><img src="./img/git.png" style="width:300%;max-width:200px" alt="Link to this page" ></a>
        <p> Open Data Certificate‚Ñ¢ disponible sur <a href="https://certificates.theodi.org/en/datasets/220195/certificate" target="_blank">ODI</a>.<p></p>
        <a href="https://certificates.theodi.org/en/datasets/220195/certificate" target="_blank"><img src="./img/odi.png" style="width:150%;max-width:150px" alt="Link to this page"></a> 
    </div>
</div>

 <!-- menu -->

 <!-- menu -->

 <script>
    // inicio NEWS
    var url = 'https://api.gdeltproject.org/api/v2/geo/geo?zoomwheel=0&query=petroleum%20(sourcelang:zho%20OR%20sourcelang:eng%20OR%20sourcelang:rus%20OR%20sourcelang:spa)%20&mode=pointdata&format=geojson';
    map.on('load', function () {
    window.setInterval(function() {
    map.getSource('NEWS').setData(url);
    }, 2000);

    map.addSource('NEWS', { type: 'geojson', data: url });
    map.addLayer({
        "id": "NEWS",
        "type": "symbol",
        "source": "NEWS",
            "layout": {
            "icon-image": "oil",
            "icon-size":[
            "interpolate",
            ["linear"],
            ["zoom"],
            0,
            0,
            9.256,
            0.1
                ]
                }
                });
                });
    // FIN NEWS
    // inicio CLUSTERNEWS
    
    map.on('load', function() {
// Add a new source from our GeoJSON data and set the
// 'cluster' option to true. GL-JS will add the point_count property to your source data.
    map.addSource("CLUSTER-NEWS", {
    type: "geojson",
// Point to GeoJSON data. This example visualizes all M1.0+ NEWS
// from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.
    data: "https://api.gdeltproject.org/api/v2/geo/geo?zoomwheel=0&query=petroleum%20(sourcelang:zho%20OR%20sourcelang:eng%20OR%20sourcelang:rus%20OR%20sourcelang:spa)%20&mode=pointdata&format=geojson",
    cluster: true,
    clusterMaxZoom: 14, // Max zoom to cluster points on
    clusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)
    });

    map.addLayer({
    id: "CLUSTER-NEWS",
    type: "circle",
    source: "CLUSTER-NEWS",
    filter: ["has", "point_count"],
paint: {

"circle-color": [
"step",
["get", "point_count"],
"#1dcaff",
5,
"#fff000",
10,
"#ff521d"
],
"circle-radius": [
"step",
["get", "point_count"],
20,
10,
30,
750,
40
]
}
});

map.addLayer({
id: "cluster-count",
type: "symbol",
source: "CLUSTER-NEWS",
filter: ["has", "point_count"],
layout: {
"text-field": "{point_count_abbreviated}",
"text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
"text-size": 12
}
});

map.addLayer({
id: "unclustered-point",
type: "circle",
source: "CLUSTER-NEWS",
filter: ["!", ["has", "point_count"]],
paint: {
"circle-color": "#11b4da",
"circle-radius": 0.1,
"circle-stroke-width": 1,
"circle-stroke-color": "#fff"
}
});

// inspect a cluster on click
map.on('click', 'clusters', function (e) {
var features = map.queryRenderedFeatures(e.point, { layers: ['clusters'] });
var clusterId = features[0].properties.cluster_id;
map.getSource('CLUSTER-NEWS').getClusterExpansionZoom(clusterId, function (err, zoom) {
if (err)
return;

map.easeTo({
center: features[0].geometry.coordinates,
zoom: zoom
});
});
});

map.on('mouseenter', 'clusters', function () {
map.getCanvas().style.cursor = 'pointer';
});
map.on('mouseleave', 'clusters', function () {
map.getCanvas().style.cursor = '';
});
});
    // fin CLUSTERNEWS
    // INICIO MENU
             
    var toggleableLayerIds = ['PRODUCTION', 'BID-ROUNDS','EXPLORATION','REFINERIES','OIL-PIPELINE','GAS-PIPELINE', 'NEWS', 'CLUSTER-NEWS'];
    for (var i = 0; i < toggleableLayerIds.length; i++) {
        var id = toggleableLayerIds[i];
        var link = document.createElement('a');
        link.href = '#';
        link.className = 'active';
        link.textContent = id;
        link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.preventDefault();
            e.stopPropagation();
            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
            if (visibility === 'visible') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                this.className = '';
            } else {
                this.className = 'active';
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            }
        };
        var layers = document.getElementById('menu');
        layers.appendChild(link);
    }
// fin MENU
    // INICIO MENU
             
    var toggleableLayerIds = ['DEPOSITS'];
    for (var i = 0; i < toggleableLayerIds.length; i++) {
        var id = toggleableLayerIds[i];
       
        var link = document.createElement('a');
        link.href = '#';
        link.className = 'focus';
        link.textContent = id;
       
        link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.preventDefault();
            e.stopPropagation();
          
            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
           
            if (visibility === 'visible') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                this.className = '';
            } else {
                this.className = 'active';
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            }
        };
        var layers = document.getElementById('menu');
        layers.appendChild(link);
    }
// fin MENU

// interacion inicio hover
var popup = new mapboxgl.Popup({
closeButton: false,
closeOnClick: false
});
map.on('mouseenter', 'DEPOSITS', function(e) {
// Change the cursor style as a UI indicator.
map.getCanvas().style.cursor = 'pointer';

var coordinates = e.features[0].geometry.coordinates.slice();
var description = e.features[0].properties.description;

// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}

// Populate the popup and set its coordinates
// based on the feature found.
popup.setLngLat(e.lngLat)
            .setHTML('<dt>' + e.features[0].properties.NAME + '</dt>'+'<dt>'+ e.features[0].properties.OTHERINFO + '</dt>' + e.features[0].properties.RESINFO + '</dt>' )
            .addTo(map);

map.on('mouseleave', 'DEPOSITS', function() {
map.getCanvas().style.cursor = '';
popup.remove();
});
});

// interacion fin hover
// interacion inicio popup
map.on('mousemove', function(event) {
    if (map.loaded()) {
        var features = map.queryRenderedFeatures(event.point, {
            layers: ['REFINERIES', 'EXPLORATION', 'BID-ROUNDS','PRODUCTION', 'NEWS']
        });
        map.getCanvas().style.cursor = features.length ? 'pointer' : '';
    }
});
window.addEventListener('resize', () => {
    mapReset();
})
 // interacion  refinerias
map.on('click', function(e) {
    var features = map.queryRenderedFeatures(e.point, {
        layers: ['REFINERIES'] // replace this with the name of the layer
    });
    if (!features.length) {
        return;
    }
    var feature = features[0];
    var popup = new mapboxgl.Popup ()
        .setLngLat(feature.geometry.coordinates)
        .setHTML('<dd>' + feature.properties.Name + feature.properties.Descriptio + '</dd>')
        .setLngLat(feature.geometry.coordinates)
        .addTo(map);
});
window.addEventListener('resize', () => {
    mapReset();
})
// interacion fin refinerias

// interacion inicio bloquesar
map.on('click', 'EXPLORATION-AREAS', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML('<dt>' + e.features[0].properties.Name + '</dt>'+'<dt>'+ e.features[0].properties.Company + '</dt>' +'<dt>'+ e.features[0].properties.Type + '</dt>'+'<dt>')
        .addTo(map);
});
// interacion fin bloquesar
  // interacion inicio bloquesar
  map.on('click', 'PRODUCTION', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML('<dt>' + e.features[0].properties.Name + '</dt>'+'<dt>'+ e.features[0].properties.Company + '</dt>' +'<dt>'+ e.features[0].properties.Type + '</dt>'+'<dt>')
        .addTo(map);
});
// interacion fin bloquesar
 // interacion inicio NEWS2
 map.on('click', 'NEWS', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML('<dd>' + e.features[0].properties.name + 
         '<img src=" '+ e.features[0].properties.shareimage + '" />' 
        + e.features[0].properties.html + '</dd>')
        .addTo(map);
});
// interacion fin NEWS
// interacion inicio BID-ROUNDS
  map.on('click', 'BID-ROUNDS', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML('<dt>' + e.features[0].properties.title + '</dt>'+'<dt>'+ e.features[0].properties.description + '</dt>' )
        .addTo(map);
});
// interacion fin bloquesar
// modal interaction
var modal = document.getElementById('aboutModal');
modal.style.display = "block";
var span = document.getElementsByClassName("close")[0];
span.onclick = function() {
    modal.style.display = "none";
}
var aboutHeader = document.getElementsByClassName("about-header")[0];
aboutHeader.onclick = function() {
    document.body.style.cursor = "pointer";
    modal.style.display = "block";
}
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";      }
}


//geocder
var customData
function forwardGeocoder(query) {
var matchingFeatures = [];
for (var i = 0; i < customData.features.length; i++) {
var feature = customData.features[i];
// handle queries with different capitalization than the source data by calling toLowerCase()
if (
feature.properties.title
.toLowerCase()
.search(query.toLowerCase()) !== -1
) {
// add a tree emoji as a prefix for custom data results
// using carmen geojson format: https://github.com/mapbox/carmen/blob/master/carmen-geojson.md
feature['place_name'] = 'üõ¢Ô∏è ' + feature.properties.title;
feature['center'] = feature.geometry.coordinates;
feature['place_type'] = ['park'];
matchingFeatures.push(feature);
}
}
return matchingFeatures;
}

map.addControl(
new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
localGeocoder: forwardGeocoder,
zoom: 9,
placeholder: 'üõ¢Ô∏è Zone p√©troli√®re',
mapboxgl: mapboxgl
}) ,'bottom-right'
);

// to grab checkbox value
$('input.js-checkboxes').prop('checked', true);
var nav = new mapboxgl.NavigationControl();
var nav2 = new mapboxgl.FullscreenControl();
var nav3 = new mapboxgl.GeolocateControl({ positionOptions: { enableHighAccuracy: true }, trackUserLocation: true });
map.addControl(nav, 'bottom-right');
map.addControl(nav2, 'bottom-right');
map.addControl(nav3, 'bottom-right');
function mapReset() {
    if (window.innerWidth < 800) {
        map.setZoom(4.17);
    } else {
        map.setZoom(4.17);
    }
}   

var distanceContainer = document.getElementById("distance");
var distanceGuide = document.getElementById("distanceGuide");
//ruler
// Array to store id's of measured lines  -- kinda irrelevant as we have a counter
var measureLayers = [];
var counter = 0;
var enabled = false;

// GeoJSON object to hold our measurement features
var geojson = {
type: "FeatureCollection",
features: []
};

// Used to draw a line between points
var linestring = {
type: "Feature",
geometry: {
    type: "LineString",
    coordinates: []
}
};

function measureDistance() {
// Step 1, Toggle
enabled = !enabled

// If disabled and source exists, remove it
if (enabled === false) {

    // Check for map source
    if (typeof map.getSource("geojson") === "object") {
        // Delete map layers from geojson
        map.removeLayer("measure-points");
        map.removeLayer("measure-lines");
        // Remove map source
        map.removeSource("geojson");
        // Remove the distance calculator
        distanceContainer.innerHTML = "";
        // Reset geojson
        geojson = {
            type: "FeatureCollection",
            features: []
        };
        // Remove mouse handler
        map.off("mousemove", measureMouseHandler);
        // Remove onclick handler
        map.off("click", measureDistanceHandler);
        // Reset mouse cursor
        map.getCanvas().style.cursor = "";
    }
} else if (enabled === true) {
    // Add data source
    map.addSource("geojson", {
        type: "geojson",
        data: geojson
    });

    // Add styles to the map
    map.addLayer({
        id: "measure-points",
        type: "circle",
        source: "geojson",
        paint: {
            "circle-radius": 5,
            "circle-color": "#ef5350"
        },
        filter: ["in", "$type", "Point"]
    });

    map.addLayer({
            id: "measure-lines",
            type: "line",
            source: "geojson",
            layout: {
                "line-cap": "round",
                "line-join": "round"
            },
            paint: {
                "line-color": "#546e7a",
                "line-width": 2.5
            },
            filter: ["in", "$type", "LineString"]
        },
        "measure-points"
    );

    // Add on click handler
    map.on('click', measureDistanceHandler)

    // UI indicator for clicking/hovering a point on the map
    map.on("mousemove", measureMouseHandler)
}
};

function measureDistanceHandler(e) {
var features = map.queryRenderedFeatures(e.point, {
    layers: ['measure-points']
});

// Remove the linestring from the group
// So we can redraw it based on the points collection
if (geojson.features.length > 1) geojson.features.pop();

// Clear the Distance container to populate it with a new value
distanceContainer.innerHTML = '';

// If a feature was clicked, remove it from the map
if (features.length) {
    var id = features[0].properties.id;
    geojson.features = geojson.features.filter(function (point) {
        return point.properties.id !== id;
    });
} else {
    var point = {
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "coordinates": [
                e.lngLat.lng,
                e.lngLat.lat
            ]
        },
        "properties": {
            "id": `measure-${counter}`
        }
    };

    geojson.features.push(point);
    counter++;
    measureLayers.push(point.properties.id);
}

// If there's a line, calculate the distance
if (geojson.features.length > 1) {
    linestring.geometry.coordinates = geojson.features.map(function (point) {
        return point.geometry.coordinates;
    });

    geojson.features.push(linestring);

    // Populate the distanceContainer with total distance
    var value = document.createElement("pre");
    // If total distance less than 1km display in metres
    if (turf.lineDistance(linestring) < 1) {
        let tDist = turf.lineDistance(linestring) * 1000;
        value.textContent = "Total distance: " + tDist.toLocaleString() + "m";
        distanceContainer.appendChild(value);
        map.getSource("geojson").setData(geojson);
    } else {
        value.textContent =
            "Total distance: " +
            turf.lineDistance(linestring).toLocaleString() +
            "km";
        distanceContainer.appendChild(value);
        map.getSource("geojson").setData(geojson);
    }
}

// Sets new data, updates layers/source
map.getSource('geojson').setData(geojson);
};

function measureMouseHandler(e) {
    var features = map.queryRenderedFeatures(e.point, {
        layers: ["measure-points"]
    });
    map.getCanvas().style.cursor = features.length ? "pointer" : "crosshair";

};    
</script>
<!--Geocoder  -->
<script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
<script src="data/geocoder.js"></script>
</body></html>
<!--Licensing information: https://roqueleal.me Purchase the pro version  -->
